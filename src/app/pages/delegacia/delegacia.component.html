<div class="container">
  <h1>Delegacias Cadastradas</h1>

  <div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#formModal" (click)="resetarFormulario()">
      Cadastrar Delegacia
    </button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>

  <div class="table-responsive">
    <table class="table table-dark table-striped table-bordered text-center align-middle">
      <thead>
        <tr>
          <th>Imagem</th>
          <th>Secretaria</th>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone Fixo</th>
          <th>Telefone Celular</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let delegacia of delegacias">
          <td>
            <img *ngIf="delegacia.imagemUrl" [src]="delegacia.imagemUrl" alt="Imagem da delegacia"
              style="width: 100px; height: 100px; object-fit: cover; border-radius: 6px;">
            <span *ngIf="!delegacia.imagemUrl">Sem imagem</span>
          </td>
          <td>{{ delegacia.secretaria }}</td>
          <td>{{ delegacia.nome }}</td>
          <td>{{ delegacia.email }}</td>
          <td>{{ delegacia.telefoneFixo || '-' }}</td>
          <td>{{ delegacia.telefoneCelular || '-' }}</td>
          <td>
            <div>
              <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#formModal"
                (click)="abrirModalEdicao(delegacia)">Editar</button>
              <button class="btn btn-sm btn-danger" (click)="confirmarExclusao(delegacia)">Excluir</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

  </div>

  <div class="modal fade" id="formModal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content dark-mode-modal">
        <div class="modal-header">
          <h5 class="modal-title" id="formModalLabel">{{ isEdicao ? 'Editar Delegacia' : 'Nova Delegacia' }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <form id="delegaciaForm" [formGroup]="delegaciaForm" (ngSubmit)="salvarDelegacia()">
            <div class="mb-3">
              <label for="imagem" class="form-label">Imagem</label>
              <input type="file" class="form-control" id="imagem" (change)="onFileChange($event)">
            </div>

            <div class="mb-3">
              <label for="nome" class="form-label">Nome da Delegacia</label>
              <input type="text" class="form-control" id="nome" formControlName="nome">
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">E-mail</label>
              <input type="email" class="form-control" id="email" formControlName="email">
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="telefoneFixo" class="form-label">Telefone Fixo</label>
                <input type="tel" class="form-control" id="telefoneFixo" formControlName="telefoneFixo">
              </div>
              <div class="col-md-6 mb-3">
                <label for="telefoneCelular" class="form-label">Telefone Celular</label>
                <input type="tel" class="form-control" id="telefoneCelular" formControlName="telefoneCelular">
              </div>
            </div>

            <div class="mb-3">
              <label for="secretaria" class="form-label">Secretaria</label>
              <input type="text" class="form-control" id="secretaria" formControlName="secretaria">
            </div>

            <div class="mb-3" *ngIf="!isEdicao">
              <label for="senha" class="form-label">Senha de Acesso</label>
              <input type="password" class="form-control" id="senha" formControlName="senha">
            </div>

            <div formGroupName="enderecoForm">
              <hr>
              <h6 class="mb-3">Endereço da Delegacia</h6>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="cep" class="form-label">CEP</label>
                  <input type="text" class="form-control" id="cep" formControlName="cep" placeholder="00000-000">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="uf">UF</label>
                  <select id="uf" class="form-control" formControlName="uf">
                    <option *ngFor="let sigla of ufSiglas" [value]="sigla">
                      {{ getUfName(sigla) }}
                    </option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="municipio" class="form-label">Município</label>
                  <input type="text" class="form-control" id="municipio" formControlName="municipio">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="bairro" class="form-label">Bairro</label>
                  <input type="text" class="form-control" id="bairro" formControlName="bairro">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="logradouro" class="form-label">Logradouro</label>
                  <input type="text" class="form-control" id="logradouro" formControlName="logradouro">
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="numero" class="form-label">Número</label>
                  <input type="text" class="form-control" id="numero" formControlName="numero">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-success" form="delegaciaForm">Salvar</button>
        </div>
      </div>
    </div>
  </div>